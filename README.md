# 股票月K统计分析系统

## 功能特点

- 📊 统计2000年至今所有A股股票的月K涨跌幅数据
- 📈 计算上涨次数、下跌次数、上涨概率、平均涨幅、平均跌幅
- 🔍 支持单只股票查询和批量统计
- 📅 支持月份筛选（单选/多选）
- 🏢 支持行业过滤和行业对比分析
- 📉 数据可视化（图表展示）
- 💾 数据导出（Excel/CSV）
- ⚙️ 灵活的数据源配置（BaoStock/tushare/FinnHub/AKShare）
- 🔐 API密钥加密存储，UI界面掩码显示

## 技术栈

- Python 3.8+
- FastAPI
- SQLite
- BaoStock/tushare/FinnHub/AKShare
- Cryptography（API密钥加密）

## 快速开始

### Windows用户

1. **安装Python 3.8+**
   - 下载地址: https://www.python.org/downloads/
   - 安装时勾选"Add Python to PATH"

2. **安装项目**
   - 双击运行 `install.bat`
   - 等待依赖包安装完成

3. **启动服务**
   - 双击运行 `start.bat`
   - 浏览器访问 http://localhost:8000

### Linux/VPS用户

1. **上传项目文件到服务器**

2. **安装和启动**
   ```bash
   chmod +x install.sh start.sh
   ./install.sh
   ./start.sh
   ```

3. **访问服务**
   - 浏览器访问 http://your-server-ip:8000

**详细部署说明请查看 [DEPLOY.md](DEPLOY.md)**

## 手动安装（可选）

如果自动安装失败，可以手动执行：

```bash
# 安装依赖
pip install -r requirements.txt

# 初始化数据库
python init_db.py

# 启动服务
python main.py
```

## 使用说明

### 1. 配置数据源API

- 启动服务后，访问 http://localhost:8000
- 点击"配置管理"标签页
- 启用需要的数据源（BaoStock/tushare/FinnHub/AKShare）
- 输入API密钥（已配置的密钥会显示为掩码，如：`abcd****`）
- 点击"测试连接"验证配置
- 点击"保存配置"保存设置

**注意：**
- BaoStock无需配置，可直接使用
- API密钥会自动加密存储
- UI界面中API密钥以掩码形式显示

### 2. 首次数据更新

- 点击"数据更新"标签页
- 先点击"更新股票列表"获取所有股票
- 然后点击"更新所有股票月K数据"（首次更新可能需要较长时间）

### 3. 查询和分析

- **单只股票查询**：输入股票代码或名称，选择月份，查看统计结果
- **批量统计**：按月份、市场、行业筛选，查看排名前N的股票
- **行业分析**：选择行业，查看该行业的月K统计
- **行业排名**：选择月份，查看该月份上涨概率最高的行业排名

### 4. 数据导出

- 在批量统计结果页面，点击"导出Excel"或"导出CSV"
- 导出的文件保存在 `static` 目录下

## 使用说明

1. **首次使用**：需要先进行数据更新（全量更新）
2. **数据更新**：每月更新一次新增数据，也可手动更新
3. **查询功能**：
   - 单只股票统计
   - 按月份筛选统计前20支股票
   - 行业分析

## 数据说明

- 使用前复权月K数据
- 仅统计A股（沪深），不包含退市股票
- 按股票实际上市日期开始统计

## 故障排查

如果遇到数据更新失败的问题：

1. **测试数据源连接**：
   ```bash
   python test_data_source.py
   ```
   这个脚本会测试BaoStock数据源是否正常工作。

2. **查看日志文件**：
   所有错误信息都会记录在 `stock_analysis.log` 文件中，查看该文件可以获取详细的错误信息。

3. **常见问题**：
   - **网络连接问题**：确保能够访问互联网，BaoStock需要网络连接
   - **数据库权限问题**：确保数据库文件有写入权限
   - **数据源服务问题**：BaoStock服务可能暂时不可用，可以稍后重试
   - **更新超时**：更新所有股票数据可能需要很长时间，建议分批更新或使用强制更新模式

