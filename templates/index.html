<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨æœˆKç»Ÿè®¡åˆ†æç³»ç»Ÿ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: #f0f0f0;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .month-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .month-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        
        .results-table th:hover {
            background: #e9ecef;
        }
        
        .results-table tr:hover {
            background: #f8f9fa;
        }
        
        .chart-container {
            margin-top: 30px;
            height: 400px;
        }
        
        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .suggestions.active {
            display: block;
        }
        
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .suggestion-item:hover {
            background: #f8f9fa;
        }
        
        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .progress-container {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š è‚¡ç¥¨æœˆKç»Ÿè®¡åˆ†æç³»ç»Ÿ</h1>
            <p>ç»Ÿè®¡2000å¹´è‡³ä»Šæ‰€æœ‰Aè‚¡è‚¡ç¥¨çš„æœˆKæ¶¨è·Œå¹…æ•°æ®</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('single')">å•åªè‚¡ç¥¨æŸ¥è¯¢</button>
            <button class="tab" onclick="switchTab('batch')">æ‰¹é‡ç»Ÿè®¡</button>
            <button class="tab" onclick="switchTab('industry')">è¡Œä¸šåˆ†æ</button>
            <button class="tab" onclick="switchTab('config')">é…ç½®ç®¡ç†</button>
            <button class="tab" onclick="switchTab('update')">æ•°æ®æ›´æ–°</button>
        </div>
        
        <!-- å•åªè‚¡ç¥¨æŸ¥è¯¢ -->
        <div id="single" class="tab-content active">
            <h2>å•åªè‚¡ç¥¨ç»Ÿè®¡</h2>
            <div class="form-group">
                <label>è‚¡ç¥¨ä»£ç /åç§°ï¼ˆæ”¯æŒè‡ªåŠ¨è¡¥å…¨ï¼‰</label>
                <div style="position: relative;">
                    <input type="text" id="single-stock-code" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°" autocomplete="off">
                    <div id="single-suggestions" class="suggestions"></div>
                </div>
            </div>
            <div class="form-group">
                <label>æœˆä»½ç­›é€‰ï¼ˆå¯é€‰ï¼Œä¸é€‰åˆ™ç»Ÿè®¡æ‰€æœ‰æœˆä»½ï¼‰</label>
                <div class="month-selector" id="single-month-selector">
                    <label class="month-checkbox"><input type="checkbox" value="1"> 1æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="2"> 2æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="3"> 3æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="4"> 4æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="5"> 5æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="6"> 6æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="7"> 7æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="8"> 8æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="9"> 9æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="10"> 10æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="11"> 11æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="12"> 12æœˆ</label>
                </div>
            </div>
            <div class="form-group">
                <label>æœ€å°æ¶¨è·Œæ¬¡æ•°</label>
                <input type="number" id="single-min-count" value="0" min="0" title="åªç»Ÿè®¡æ€»æ¶¨è·Œæ¬¡æ•°ï¼ˆä¸Šæ¶¨+ä¸‹è·Œï¼‰å¤§äºç­‰äºæ­¤å€¼çš„è‚¡ç¥¨">
            </div>
            <div class="form-group" id="single-statistics-mode-group" style="display: none;">
                <label>ç»Ÿè®¡æ–¹å¼</label>
                <div style="display: flex; gap: 20px; align-items: center;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="radio" name="single-statistics-mode" value="summary" checked style="margin-right: 5px;">
                        <span>æ±‡æ€»ç»Ÿè®¡</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="radio" name="single-statistics-mode" value="monthly" style="margin-right: 5px;">
                        <span>æŒ‰æœˆç»Ÿè®¡</span>
                    </label>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    æ±‡æ€»ç»Ÿè®¡ï¼šå°†æ‰€æœ‰é€‰ä¸­æœˆä»½åˆå¹¶ç»Ÿè®¡ | æŒ‰æœˆç»Ÿè®¡ï¼šåˆ†åˆ«æ˜¾ç¤ºå„æœˆä»½çš„ç»Ÿè®¡æ•°æ®
                </small>
            </div>
            <button class="btn btn-primary" onclick="querySingleStock()">æŸ¥è¯¢</button>
            <div id="single-loading" class="loading">åŠ è½½ä¸­...</div>
            <div id="single-results"></div>
        </div>
        
        <!-- æ‰¹é‡ç»Ÿè®¡ -->
        <div id="batch" class="tab-content">
            <h2>æ‰¹é‡ç»Ÿè®¡</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>å¸‚åœºç­›é€‰</label>
                    <select id="batch-market">
                        <option value="">å…¨éƒ¨</option>
                        <option value="sh">ä¸Šæµ·</option>
                        <option value="sz">æ·±åœ³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è¡Œä¸šç­›é€‰</label>
                    <select id="batch-industry">
                        <option value="">å…¨éƒ¨</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æœ€å°æ¶¨è·Œæ¬¡æ•°</label>
                    <input type="number" id="batch-min-count" value="0" min="0" title="åªç»Ÿè®¡æ€»æ¶¨è·Œæ¬¡æ•°ï¼ˆä¸Šæ¶¨+ä¸‹è·Œï¼‰å¤§äºç­‰äºæ­¤å€¼çš„è‚¡ç¥¨">
                </div>
                <div class="form-group">
                    <label>æ’åºæ–¹å¼</label>
                    <select id="batch-order-by">
                        <option value="up_probability">ä¸Šæ¶¨æ¦‚ç‡</option>
                        <option value="avg_up_pct">å¹³å‡æ¶¨å¹…</option>
                        <option value="avg_down_pct">å¹³å‡è·Œå¹…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ˜¾ç¤ºæ•°é‡</label>
                    <input type="number" id="batch-limit" value="20" min="1" max="100">
                </div>
            </div>
            <div class="form-group">
                <label>æœˆä»½ç­›é€‰ï¼ˆå¯é€‰ï¼‰</label>
                <div class="month-selector" id="batch-month-selector">
                    <label class="month-checkbox"><input type="checkbox" value="1"> 1æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="2"> 2æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="3"> 3æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="4"> 4æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="5"> 5æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="6"> 6æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="7"> 7æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="8"> 8æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="9"> 9æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="10"> 10æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="11"> 11æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="12"> 12æœˆ</label>
                </div>
            </div>
            <button class="btn btn-primary" onclick="queryBatch()">æŸ¥è¯¢</button>
            <button class="btn btn-success" onclick="exportExcel()">å¯¼å‡ºExcel</button>
            <button class="btn btn-success" onclick="exportCSV()">å¯¼å‡ºCSV</button>
            <div id="batch-loading" class="loading">åŠ è½½ä¸­...</div>
            <div id="batch-results"></div>
        </div>
        
        <!-- è¡Œä¸šåˆ†æ -->
        <div id="industry" class="tab-content">
            <h2>è¡Œä¸šåˆ†æ</h2>
            <div class="form-group">
                <label>é€‰æ‹©è¡Œä¸š</label>
                <select id="industry-select">
                    <option value="">è¯·é€‰æ‹©è¡Œä¸š</option>
                </select>
            </div>
            <div class="form-group">
                <label>æœ€å°æ¶¨è·Œæ¬¡æ•°</label>
                <input type="number" id="industry-min-count" value="0" min="0" title="åªç»Ÿè®¡æ€»æ¶¨è·Œæ¬¡æ•°ï¼ˆä¸Šæ¶¨+ä¸‹è·Œï¼‰å¤§äºç­‰äºæ­¤å€¼çš„è‚¡ç¥¨">
            </div>
            <div class="form-group">
                <label>æœˆä»½ç­›é€‰ï¼ˆå¯é€‰ï¼‰</label>
                <div class="month-selector" id="industry-month-selector">
                    <label class="month-checkbox"><input type="checkbox" value="1"> 1æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="2"> 2æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="3"> 3æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="4"> 4æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="5"> 5æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="6"> 6æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="7"> 7æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="8"> 8æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="9"> 9æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="10"> 10æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="11"> 11æœˆ</label>
                    <label class="month-checkbox"><input type="checkbox" value="12"> 12æœˆ</label>
                </div>
            </div>
            <div class="form-group" id="industry-statistics-mode-group" style="display: none;">
                <label>ç»Ÿè®¡æ–¹å¼</label>
                <div>
                    <label style="margin-right: 20px;">
                        <input type="radio" name="industry-statistics-mode" value="monthly" checked> æŒ‰æœˆç»Ÿè®¡
                    </label>
                    <label>
                        <input type="radio" name="industry-statistics-mode" value="summary"> æ±‡æ€»ç»Ÿè®¡
                    </label>
                </div>
            </div>
            <button class="btn btn-primary" onclick="queryIndustry()">æŸ¥è¯¢</button>
            <div id="industry-loading" class="loading">åŠ è½½ä¸­...</div>
            <div id="industry-results"></div>
            
            <hr style="margin: 30px 0;">
            <h3>æŒ‰æœˆä»½æ’åæŸ¥è¯¢</h3>
            <p style="color: #666; margin-bottom: 20px;">æŸ¥è¯¢æŒ‡å®šæœˆä»½æ‰€æœ‰è¡Œä¸šçš„ä¸Šæ¶¨æ¦‚ç‡æ’å</p>
            <div class="form-group">
                <label>é€‰æ‹©æœˆä»½</label>
                <select id="rank-month-select">
                    <option value="1">1æœˆ</option>
                    <option value="2">2æœˆ</option>
                    <option value="3">3æœˆ</option>
                    <option value="4">4æœˆ</option>
                    <option value="5">5æœˆ</option>
                    <option value="6">6æœˆ</option>
                    <option value="7">7æœˆ</option>
                    <option value="8">8æœˆ</option>
                    <option value="9">9æœˆ</option>
                    <option value="10">10æœˆ</option>
                    <option value="11">11æœˆ</option>
                    <option value="12">12æœˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label>æœ€å°æ¶¨è·Œæ¬¡æ•°</label>
                <input type="number" id="rank-min-count" value="0" min="0" title="åªç»Ÿè®¡æ€»æ¶¨è·Œæ¬¡æ•°ï¼ˆä¸Šæ¶¨+ä¸‹è·Œï¼‰å¤§äºç­‰äºæ­¤å€¼çš„è¡Œä¸š">
            </div>
            <div class="form-group">
                <label>æ˜¾ç¤ºæ•°é‡</label>
                <input type="number" id="rank-limit" value="20" min="1" max="100">
            </div>
            <button class="btn btn-primary" onclick="queryIndustryRank()">æŸ¥è¯¢æ’å</button>
            <div id="industry-rank-loading" class="loading">åŠ è½½ä¸­...</div>
            <div id="industry-rank-results"></div>
        </div>
        
        <!-- é…ç½®ç®¡ç† -->
        <div id="config" class="tab-content">
            <h2>æ•°æ®æºé…ç½®</h2>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="config-baostock" checked> å¯ç”¨BaoStockï¼ˆä¼˜å…ˆï¼‰
                </label>
                <div id="test-baostock-result" style="margin-left: 25px; margin-top: 5px; font-size: 12px;"></div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="config-tushare"> å¯ç”¨tushareï¼ˆå¤‡ç”¨ï¼‰
                </label>
                <input type="password" id="config-tushare-token" placeholder="tushare tokenï¼ˆå·²é…ç½®çš„å¯†é’¥ä¼šæ˜¾ç¤ºä¸ºæ©ç ï¼‰" style="margin-top: 10px; width: 300px;">
                <div id="test-tushare-result" style="margin-left: 25px; margin-top: 5px; font-size: 12px;"></div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="config-finnhub"> å¯ç”¨FinnHubï¼ˆå¤‡ç”¨ï¼Œä¸»è¦æ”¯æŒç¾è‚¡ï¼‰
                </label>
                <input type="password" id="config-finnhub-key" placeholder="FinnHub API Keyï¼ˆå·²é…ç½®çš„å¯†é’¥ä¼šæ˜¾ç¤ºä¸ºæ©ç ï¼‰" style="margin-top: 10px; width: 300px;">
                <div id="test-finnhub-result" style="margin-left: 25px; margin-top: 5px; font-size: 12px;"></div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="config-akshare"> å¯ç”¨AKShareï¼ˆæ¨èï¼Œå…è´¹ï¼Œæ”¯æŒAè‚¡è¡Œä¸šä¿¡æ¯ï¼‰
                </label>
                <div id="test-akshare-result" style="margin-left: 25px; margin-top: 5px; font-size: 12px;"></div>
                <small style="display: block; margin-left: 25px; margin-top: 5px; color: #666;">
                    AKShareå…è´¹ä¸”ç¨³å®šï¼Œæä¾›Aè‚¡è¡Œä¸šåˆ†ç±»ä¿¡æ¯ï¼Œæ¨èç”¨äºè¡Œä¸šåˆ†æ
                </small>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
                <button class="btn btn-success" onclick="testConnections()" style="margin-left: 10px;">æµ‹è¯•è¿æ¥</button>
            </div>
            <div id="config-message" style="margin-top: 15px;"></div>
        </div>
        
        <!-- æ•°æ®æ›´æ–° -->
        <div id="update" class="tab-content">
            <h2>æ•°æ®æ›´æ–°</h2>
            <div class="form-group">
                <label>æ›´æ–°è‚¡ç¥¨åˆ—è¡¨</label>
                <button class="btn btn-primary" id="update-stock-list-btn" onclick="updateStockList()">æ›´æ–°è‚¡ç¥¨åˆ—è¡¨</button>
            </div>
            <div class="form-group">
                <label>æ›´æ–°æœˆKæ•°æ®</label>
                <button class="btn btn-primary" id="update-monthly-btn" onclick="updateMonthlyData()">æ›´æ–°æ‰€æœ‰è‚¡ç¥¨æœˆKæ•°æ®</button>
                <label style="margin-left: 20px;">
                    <input type="checkbox" id="force-update"> å¼ºåˆ¶å…¨é‡æ›´æ–°
                </label>
            </div>
            <div id="update-message"></div>
        </div>
    </div>
    
    <script src="/static/app.js"></script>
</body>
</html>


